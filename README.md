# Конвертер базы данных ГАР (Государственный адресный реестр)

Этот проект представляет собой конвертер данных из полной базы данных ГАР в упрощенную структуру для Приморского края и Артемовского городского округа.

## Описание

Конвертер извлекает данные из базы данных ГАР, фильтрует их по указанному региону (Приморский край, Артемовский г.о.) и преобразует в более простую структуру. Обработка осуществляется на основе иерархии путей, хранящихся в таблице `mun_hierarchy`.

Результат работы конвертера - заполненные таблицы в целевой базе данных:
- `localities` - населенные пункты
- `streets` - улицы
- `buildings` - дома

## Требования

- Python 3.6+
- MySQL/MariaDB
- Установленные пакеты из requirements.txt

## Установка

1. Клонируйте репозиторий:
```bash
git clone https://github.com/user/gar-converter.git
cd gar-converter
```

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Настройте параметры подключения к базам данных в файле `.env`:
```
# Параметры подключения к исходной базе данных
SOURCE_DB_HOST=localhost
SOURCE_DB_PORT=3306
SOURCE_DB_USER=root
SOURCE_DB_PASSWORD=root
SOURCE_DB_NAME=gar_address

# Параметры подключения к целевой базе данных
TARGET_DB_HOST=localhost
TARGET_DB_PORT=3306
TARGET_DB_USER=root
TARGET_DB_PASSWORD=root
TARGET_DB_NAME=gar_simple_db

# Путь к файлу дампа SQL
DUMP_FILE_PATH=D:/tmp/dump.sql 

# Базовый путь (Приморский край, Артемовский г.о.)
BASE_PATH=381755.95238215
```

## Использование

Запустите конвертер:
```bash
python run_converter.py
```

## Процесс работы

1. **Этап 1**: Получение всех объектов для Приморского края и Артемовского ГО на основе базового пути (`381755.95238215`).

2. **Этап 2**: Извлечение и сохранение населенных пунктов (3-й октет пути).
   - Поиск в таблице `addr_obj` по `objectid`
   - Сохранение в таблицу `localities`

3. **Этап 3**: Извлечение и сохранение улиц (4-й октет пути).
   - Поиск в таблице `addr_obj` по `objectid`
   - Связывание с населенными пунктами
   - Сохранение в таблицу `streets`

4. **Этап 4**: Извлечение и сохранение домов (5-й октет пути).
   - Поиск в таблице `houses` по `objectid`
   - Связывание с улицами
   - Сохранение в таблицу `buildings`

## Структура проекта

- `run_converter.py` - основной файл для запуска конвертера
- `converter.py` - класс конвертера с основной логикой
- `db_utils.py` - утилиты для работы с базами данных
- `.env` - файл с настройками подключения
- `requirements.txt` - список зависимостей
- `mysql_schema.sql` - схема исходной базы данных mysql
- `psql_schema.sql` - схема исходной базы данных postgressql

## Автор

Ваше имя или команда

## Лицензия

MIT 